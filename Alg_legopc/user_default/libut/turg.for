C**********************************************************************
C modulo turg.f
C tipo 
C release 5.2
C data 4/12/95
C reserver @(#)turg.f	5.2
C**********************************************************************
      SUBROUTINE TURGI3(IFO,IOB,DEBL)
C
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      COMMON/TURG01/IBLOC
      COMMON/TURG02/NCEL,NPAR
      CHARACTER*80 DEBL
      CHARACTER*8 IBLOC
      CHARACTER*4 IOB
      CHARACTER*4 MOD
      DATA MOD/'TURG'/
C
      CALL TURGI4(IOB,MOD)
      NSTATI = 1
      NUSCIT = 9
      NINGRE = 7
      WRITE(IFO,2999)IBLOC,IOB,MOD,DEBL
 2999 FORMAT(A,2X,'BL.-',A4,'- **** MODULO ',A4,' - ',A)
      WRITE(IFO,3001)IOB
 3001 FORMAT('QTG ',A4,2X,
     $'--US-- POWER PRODUCED BY THE TURBOGAS GROUP')
      WRITE(IFO,3002)IOB
 3002 FORMAT('WFU ',A4,2X,
     $'--UA-- FLUE GAS FLOW RATE INTO THE TG')
      WRITE(IFO,3003)IOB
 3003 FORMAT('TFU ',A4,2X,
     $'--UA-- FLUE GAS TEMPERATURE AT THE TG OUTLET')
      WRITE(IFO,3004)IOB
 3004 FORMAT('TTER',A4,2X,
     $'--UA-- MEASURED FLUE GAS TEMPERATURE IN THE TG')
      WRITE(IFO,3005)IOB
 3005 FORMAT('TTRX',A4,2X,
     $'--UA-- REFERENCE FLUE GAS TEMPERATURE TG')
      WRITE(IFO,3006)IOB
 3006 FORMAT('PCD ',A4,2X,
     $'--UA-- EXHAUST PRESSURE OF THE TG COMPRESSOR')
      WRITE(IFO,3007)IOB
 3007 FORMAT('PDIF',A4,2X,
     $'--UA-- PRESSURE DIFF. SUCTION FILTER OF THE TG')
      WRITE(IFO,3008)IOB
 3008 FORMAT('RVEL',A4,2X,
     $'--UA-- MONITORED ROTATIONAL SPEED OF THE TG ROTOR')
      WRITE(IFO,3009)IOB
 3009 FORMAT('ZWMC',A4,2X,
     $'--UA-- MONITORED FUEL FLOW RATE OF THE TG')
      WRITE(IFO,3010)IOB
 3010 FORMAT('ZMIG',A4,2X,
     $'--UA-- MONITORED IGV POSITION IN THE TG')
      WRITE(IFO,3011)IOB
 3011 FORMAT('ZIGV',A4,2X,
     $'--IN-- REQUESTED IGV POSITION OF THE TG')
      WRITE(IFO,3012)IOB
 3012 FORMAT('ZWCO',A4,2X,
     $'--IN-- REQUESTED FUEL FLOW RATE IN THE TG')
      WRITE(IFO,3013)IOB
 3013 FORMAT('TAMB',A4,2X,
     $'--IN-- EXTERNAL AMBIENT TEMPERATURE AT THE SUCTION OF THE TG')
      WRITE(IFO,3014)IOB
 3014 FORMAT('RPM ',A4,2X,
     $'--IN-- ROTATIONAL SPEED OF THE TG SHUFFLE')
      WRITE(IFO,3015)IOB
 3015 FORMAT('ALAV',A4,2X,
     $'--IN-- STARTING BUTTON OF THE TG')
      WRITE(IFO,3016)IOB
 3016 FORMAT('ALSC',A4,2X,
     $'--IN-- TRIP BUTTON OF THE TG')
      WRITE(IFO,3017)IOB
 3017 FORMAT('ALSH',A4,2X,
     $'--IN-- SHUT DOWN BUTTON OF THE TG')
      RETURN
      END
C*********************************************************************
      SUBROUTINE TURGI4(IOB,MOD)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      COMMON/TURG01/IBLOC
      COMMON/TURG02/NCEL,NPAR
      CHARACTER*8 IBLOC
      CHARACTER*4 IOB
      CHARACTER*4 MOD
C
C
      WRITE(IBLOC,1000)MOD,IOB
 1000 FORMAT(2A4)
      RETURN
      END
      SUBROUTINE TURGI2(IFUN,VAR,MX1,IV1,IV2,XYU,DATI,ID1,ID2,
     1    IBL1,IBL2,IER,CNXYU,TOL)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      INTEGER VAR
      DIMENSION VAR(MX1,*),XYU(*),DATI(*),CNXYU(*),TOL(*)
      COMMON/NORM/P0,H0,T0,W0,RO0,AL0,V0,DP0
C
C---TURBINA A GAS NUOVO PIGNONE/FIAT
C
      GO TO(100,200),IFUN
C--   DPIN  : PERDITE DI CARICO ALL'INGRESSO DELLA MACCHINA
C--           IN CONDIZIONI NOMINALI (Pa)
C--   DPOUT : PERDITE DI CARICO ALL'USCITA DELLA MACCHINA
C--           IN CONDIZIONI NOMINALI (Pa)
C--   PCDN  : PRESSIONE NOMINALE DI SCARICO DEL COMPRESSORE (Pa)
C--   TIPO  : TIPO DI MACCHINA (NUOVO PIGNONE=1)
C--   TFOUT : TEMPERATURA DEI FUMI ALL'USCITA IN CONDIZIONI
C--           NOMINALI ISO (K)
C--   TFIN  : TEMPERATURA DEI FUMI IN INGRESSO IN CONDIZIONI ISO (K)
C--   WFNOM : PORTATA NOMINALE DEI FUMI (KG/S)
C--     QTGNOM: POTENZA NOMINALE (W)
C--   TPOS1 : COSTANTE DI TEMPO AL NUMERATORE DEL POLO ZERO DEL
C--             SISTEMA DEL COMBUSTIBILE (S)
C--   TPOS2 : COSTANTE DI TEMPO AL DENOMINATORE DEL POLO ZERO DEL
C--             SISTEMA DEL COMBUSTIBILE (S)
C--       : COSTANTE DI TEMPO DOVUTA ALLE TUBAZIONI DEL SISTEMA
C--             DI ALIMENTAZIONE DEL COMBUSTIBILE (S)
C--   TPOT  : COSTANTE DI TEMPO APPROSSIMANTE LA DINAMICA DELLA POTENZA
C--   TSCHE : COSTANTE DI TEMPO APPROSSIMANTE LA DINAMICA DELL0 SCHERMO
C--           DELLE TERMOCOPPIE
C--   GSCHE : GUADAGNO DELLO SCHERMO DELLE TERMOCOPPIE
C--   TWFU  : COSTANTE DI TEMPO APPROSSIMANTE LA DINAMICA DELLA PORTATA
C--           DEI FUMI

100   WRITE(14,500)  'DPIN    ','DPOUT   ','PCDN    ',
     1               'TIPO    ','TFOUT   ','TFIN    ',
     1               'WFNOM   ','QTGNOM  ','TPOT    ',
     1               'TWFU    ','TSCHE   ','GSCHE   ',
     1               'TPOS1   ','TPOS2   '
      RETURN
C
C---lettura e memorizzazione dati
C
  200 READ(14,501)
      READ(14,501)  DPIN,DPOUT,PCDN,TIPO,TFOUT,TFIN,WFNOM,QTGNOM,
     1              TPOT,TWFU,TSCHE,GSCHE,TPOS1,TPOS2
  500 FORMAT(3(4X,A8,' =',10X,'*'))
  501 FORMAT(3(14X,F10.0,1X))
C
C--   RGAS E' LA COSTANTE DEI GAS PERFETTI
C
      DATA RGAS/287./
C
C--   CALCOLO DEI VALORI DELLA DENSITA' DELL'ARIA E DEI FUMI IN
C--   CONDIZIONI DI TEMPERATURA NOMINALI
C
      ROIN=1.E5/(RGAS*TFIN)
      ROOUT=1.E5/(RGAS*TFOUT)
      AKIN=DPIN*ROIN/WFNOM/WFNOM
      AKOUT=DPOUT*ROOUT/WFNOM/WFNOM
	TRIFU=0.
	IF(TIPO.lt.0.) then
	   TIPO=-TIPO
	   TRIFU=1.
	ENDIF
C
      DTAV=0.
      DTSC=0.
      DTSH=0.
      DATI(ID2  ) = AKIN
      DATI(ID2+1) = AKOUT
      DATI(ID2+24) =PCDN
      DATI(ID2+2) = WFNOM
      DATI(ID2+3) = QTGNOM
      DATI(ID2+4) = TIPO
      DATI(ID2+5) = TFOUT
      DATI(ID2+6) = TPOS1
C     DATI(ID2+7) = TTUB
      DATI(ID2+30)= TPOT
      DATI(ID2+31)= TSCHE
      DATI(ID2+32)= GSCHE
      DATI(ID2+33)= TWFU
      DATI(ID2+34)= TPOS2
      DATI(ID2+35)= TRIFU
      DATI(ID2+36)= DTSH
      DATI(ID2+37)= DTAV
      DATI(ID2+38)= DTSC
      ID2 = ID2+38
C
C---costanti di normalizzazione
C
      Q0=H0*W0
      CNXYU(IV1  ) = Q0
      CNXYU(IV1+1) = W0
      CNXYU(IV1+2) = T0
      CNXYU(IV1+3) = T0
      CNXYU(IV1+4) = T0
      CNXYU(IV1+5) = P0
      CNXYU(IV1+6) = P0
      CNXYU(IV1+7) = 300.
      CNXYU(IV1+8) = 100.
      CNXYU(IV1+9) = 100.
      CNXYU(IV1+10) = 100.
      CNXYU(IV1+11) = 100.
      CNXYU(IV1+12) = T0
      CNXYU(IV1+13) = 300.
      CNXYU(IV1+14) = 1.
      CNXYU(IV1+15) = 1.
      CNXYU(IV1+16) = 1.
      RETURN
      END
      SUBROUTINE TURGC1(IFUN,AJAC,MX5,IXYU,XYU,IPD,DATI,RNI,IBL1,IBL2)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      DIMENSION AJAC(MX5,*),XYU(*),DATI(*),RNI(*)
      EXTERNAL TURG
C
C---TURBINA A GAS NUOVO PIGNONE/FIAT
C
      GO TO(100,200,300),IFUN
C
C---topologia jacobiano
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
  100 DO I = 1,10
      DO J = 11,17
      AJAC(I,J) = 1.
      END DO
      END DO
      DO I = 1,10
      AJAC(I,I) = 1.
      ENDDO
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
      RETURN
C
C
  200 CALL TURG(IFUN,IXYU,XYU,IPD,DATI,RNI)
      RETURN
C
C---calcolo jacobiano numerico
C
  300 NSTATI = 1
      NUSCIT = 9
      NINGRE = 7
      EPS    = 1.E-3
      EPSLIM = 1.E-4
      CALL NAJAC(AJAC,MX5,IXYU,XYU,IPD,DATI,RNI,
     1    NSTATI,NUSCIT,NINGRE,EPS,EPSLIM,TURG)
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C     DO I=2,NUSCIT+1
C     DO J=2,NUSCIT+1
C     AJAC(I,J) = 0.
C     ENDDO
C     AJAC(I,I) = -1.
C     ENDDO
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
      RETURN
      END
      SUBROUTINE TURG(IFUN,IXYU,XYU,IPD,DATI,RNI)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      DIMENSION XYU(*),DATI(*),RNI(*)
      COMMON/NORM/P0,H0,T0,W0,RO0,AL0,V0,DP0
      COMMON/INTEGR/TSTOP,TEMPO,DTINT,NPAS,CDT                          !SNGL
C      COMMON/INTEG1/TSTOP,TEMPO,DTINT,CDT,ALFADT,NPAS                   !DBLE
      COMMON/PARPAR/NUL(7),ITERT
      LOGICAL KREGIM,SD,SC,JFLOLOG
      COMMON/REGIME/KREGIM
      INTEGER K
C      INTEGER SC, SD
C
C   CALCOLO RESIDUI
C
C
C---decodifica variabili e dati
C
      Q0=H0*W0
      QTG = XYU(IXYU  )*Q0
      QFU = XYU(IXYU+1)*W0
      TFU = XYU(IXYU+2)*T0
      TTERM = XYU(IXYU+3)*T0
      TTRX = XYU(IXYU+4)*T0
      PCD = XYU(IXYU+5)*P0
      PDIFF =XYU(IXYU+6)*P0
      VELO = XYU(IXYU+7)*300.
      QCT = XYU(IXYU+8)*100.
      ALZT = XYU(IXYU+9)*100.
      XIGV = XYU(IXYU+10)*100.
      QCOM  = XYU(IXYU+11)*100.
      TAMB = XYU(IXYU+12)*T0
      FREQ = XYU(IXYU+13)*300.
      AV = XYU(IXYU+14)*1.
      SC = JFLOLOG(XYU(IXYU+15)*1.)
      SD = JFLOLOG(XYU(IXYU+16)*1.)
      AKIN = DATI(IPD  )
      AKOUT = DATI(IPD+1)
      PCDN = DATI(IPD+24)
      WFNOM = DATI(IPD+2)
      QTGNOM = DATI(IPD+3)
      TIPO = DATI(IPD+4)
      TFOUT = DATI(IPD+5)
      TPOS1 = DATI(IPD+6)
C     TTUB = DATI(IPD+7)
      K=DATI(IPD+25)
      TPOT=DATI(IPD+30)
      TSCHE=DATI(IPD+31)
      GSCHE=DATI(IPD+32)
      TWFU=DATI(IPD+33)
      TPOS2=DATI(IPD+34)
	TRIFU=DATI(IPD+35)
C
      IF(AV.EQ.1.OR.AV.EQ.2.) THEN
      QCOM=29.
C--     CHIAMATA SUBROUTINE PER AVVIAMENTO
      CALL TURGAVVI(IFUN,IXYU,XYU,IPD,DATI,RNI)
      RETURN
      ENDIF
      IF(SD) THEN
C--     CHIAMATA SUBROUTINE PER SHUT DOWN
      CALL TURGSHUD(IFUN,IXYU,XYU,IPD,DATI,RNI)
      RETURN
      ENDIF
      IF(SC) THEN
C--     CHIAMATA SUBROUTINE PER SCATTO
      CALL TURGSCAT(IFUN,IXYU,XYU,IPD,DATI,RNI)
      RETURN
      ENDIF
C
C---- MODIFICHE PER AVVIAMENTO E SPEGNIMENTO RIPETUTI
C
      DTSC=0.
      DTSH=0.
      DATI(IPD+36)=DTSH
      DATI(IPD+38)=DTSC
C
      K=0

C--   CONVERSIONE FREQUENZA DA GIRI AL MINUTO
C--   IN PER UNIT
      OMEGA=FREQ/3000.
C--   CALCOLO DENSITA' ARIA E FUMI IN CONDIZIONI DI TEMPERATURA REALI
      DATA RGAS/287./
      ROIN=1.E5/(RGAS*TAMB)
      ROOUT=1.E5/(RGAS*TFU)
C--   CALCOLO PERDITE (Pa) IN CONDIZIONI DI PORTATA REALE
      XIPXLOSS=AKIN*QFU*QFU/ROIN
      XOPXLOSS=AKOUT*QFU*QFU/ROOUT
C------CONVERSIONE PASCAL mmH2O
      XINXLOSS=XIPXLOSS/10.
      XOUTXLOSS=XOPXLOSS/10.
C------CONVERSIONE DI TEMPERATURA
C--   TAMB=KELVIN
C--   FTAMB=FARENHEIT
C--   CTAMB=CENTIGRADI
      FTAMB=(TAMB-273.15)*1.8+32.
      CTAMB=TAMB-273.15
C-------TRANSITORIO DI COMBUSTIBILE--------------
      IF(KREGIM) GOTO 217
      IF(ITERT.LE.0.AND.IFUN.EQ.2) THEN
      DATI(IPD+15)=DATI(IPD+16)
      DATI(IPD+8)=DATI(IPD+9)
      DATI(IPD+10)=DATI(IPD+11)
      DATI(IPD+12)=DATI(IPD+13)
      ENDIF

      QX=DATI(IPD+8)
      QY=DATI(IPD+10)
      QZ=DATI(IPD+12)
      OMEGAP=DATI(IPD+15)
      IF(DTINT.LE.0.) THEN
	DTINT=.2
      AN1=(1.-EXP(-DTINT/TPOS2))/(1.-EXP(-DTINT/TPOS1))
      AN2=EXP(-DTINT/TPOS2)
      AN3=EXP(-DTINT/TPOS1)
      ELSE
      AN1=(1.-EXP(-DTINT/TPOS2))/(1.-EXP(-DTINT/TPOS1))
      AN2=EXP(-DTINT/TPOS2)
      AN3=EXP(-DTINT/TPOS1)
      ENDIF
      QCX=QX*AN2+AN1*QCOM-AN1*AN3*QZ
      IF(TIPO.EQ.1.) THEN
      QCY=QY*EXP(-DTINT/TPOS2)+.5*(OMEGA+OMEGAP)*(1.-EXP(-DTINT/TPOS2))
      ELSE
      QCY=1.00000
      ENDIF
      QC=QCY*QCX
      DATI(IPD+9)=QCX
      DATI(IPD+11)=QCY
      DATI(IPD+13)=QCOM
      DATI(IPD+16)=OMEGA
      GOTO 218
217   CONTINUE
C--   CALCOLO REGIME STAZIONARIO
      IF(TIPO.EQ.1.) THEN
      QCXX=(QCOM*OMEGA)
      ELSE
      QCXX=QCOM
      ENDIF
      QC=QCXX
      DATI(IPD+9)=QCXX
      DATI(IPD+11)=OMEGA
      DATI(IPD+13)=QCXX
      DATI(IPD+16)=OMEGA
C
C------SCELTA TURBINA FIAT - NUOVO PIGNONE
218   IF(TIPO.EQ.1.) THEN
C-------------------------------------------
C------CALCOLO TURBINA NUOVO PIGNONE--------
C-------------------------------------------
C------CALCOLO POTENZA MASSIMA (W)
      QMAX=QTGNOM*TGXFU1(FTAMB)*TGXFU2(XINXLOSS)*TGXFU3(XOUTXLOSS)

C------CALCOLO POTENZA (W)

      QTGC=QMAX*TGXFU9(QC)+QTGNOM*(.5*(1.-OMEGA)*OMEGA)
      QTGP=100*(QTGC/(QTGNOM*TGXFU2(XINXLOSS)*TGXFU3(XOUTXLOSS)))
C------CALCOLO PORTATA GAS (KG/S)
C--   POSIZIONE IGV PER TURBINA NUOVO PIGNONE
C--   100%----84 APERTURA MASSIMA
C--   46%-----57 POSIZIONE FULL SPEAD NO LOAD
C--   0%------34 POSIZIONE ALL'AVVIAMENTO

      QFUC=WFNOM*(TGXFU11(XIGV,FTAMB))*TGXFU7(XINXLOSS)+
     $      (FREQ-3000.)*.13633

C------CALCOLO TEMP. USCITA GAS (K)
      XIGVC=XIGV-46.
      TFUC=(TGXFU4(QTGP,FTAMB)+TGXFU5(XINXLOSS)+TGXFU6(XOUTXLOSS))*
     $  (TFOUT/805.) -((230.+TGXFU60( FTAMB))/54.)*
     $   XIGVC*TGXFU70(QTGC/QMAX)
      TFUCC=((TFUC-32.)/1.8+306.*(1.-OMEGA))+273.15
C--   CALCOLO TEMPERATURA DI RIFERIMENTO
	IF(TRIFU.EQ.1) THEN
	   TTRXC= TGXUTXFU10(QTGP,FTAMB)
	ELSE
	   TTRXC= TGXFU10(QTGP,FTAMB)
	ENDIF
C--   CALCOLO PRESSIONE DI SCARICO COMPRESSORE
      PCDC=PCDN*.01*(0.32*QTGP+68.)*TGXFU15(XIGV)
C--   VELOCITA' PORTATA DI COMB. POSIZIONE IGV DURANTE
C--   I TRANSITORI DI AVVIAMENTO SCATTO SHUT DOWN;
C--   DURANTE IL FUNZIONAMENTO NORMALE SONO:
      VELOC=FREQ
      QCTC=QCOM
      ALZTC=XIGV
      IF(KREGIM) GOTO 1111
C---  CALCOLO TRANSITORIO TURBOGAS NUOVO PIGNONE
      IF(ITERT.LE.0.AND.IFUN.EQ.2) THEN
C--   RICHIAMO DEI DATI DELL'ITERAZIONE PRECEDENTE
      DATI(IPD+14)=QTG
      DATI(IPD+17)=QFU
      DATI(IPD+18)=DATI(IPD+19)
      DATI(IPD+20)=DATI(IPD+23)
      DATI(IPD+21)=DATI(IPD+22)
      ENDIF

      PX=DATI(IPD+14)
      QFS=DATI(IPD+17)
      QB=DATI(IPD+18)
      TV=DATI(IPD+20)
      TINX=DATI(IPD+21)
C--   POTENZA
      RNI(1) = (-QTG/TPOT+QTGC/TPOT)/(H0*W0)
C--   PORTATA
      QUX=QFS*EXP(-DTINT/TWFU)+.5*(QFUC+QB)*(1.-EXP(-DTINT/TWFU))
      RNI(2)=(QFU-QUX)/W0

C--   TEMPERATURA FUMI (NON E' RITARDATA)
      RNI(3)=(TFU-TFUCC)/T0
C--   TEMPERATURA MISURATA DALLE TERMOCOPPIE
      TOUTCX=TV*EXP(-DTINT/TSCHE)+.5*GSCHE*(TFUCC+TINX)*
     $          (1.-EXP(-DTINT/TSCHE))
      TC=TOUTCX+(1.-GSCHE)*TFUCC
      RNI(4)=(TTERM-TC)/T0
C--   TEMPERATURA DI RIFERIMENTO
      RNI(5)=(TTRX-TTRXC)/T0
C--   PRESSIONE DI SCARICO COMPRESSORE ASSIALE
      RNI(6)=(PCD-PCDC)/P0
C--   PERDITE DI CARICO ALL'INGRESSO
      RNI(7)=(PDIFF-XIPXLOSS)/P0
C--   VELOCITA' NEI TRANSITORI DI AVVIAMENTO,SCATTO,SHUT DOWN
      RNI(8)=(VELO-VELOC)/300.
C--   VELOCITA' NEI TRANSITORI DI AVVIAMENTO,SCATTO,SHUT DOWN
      RNI(9)=(QCT-QCTC)/100.
C--   VELOCITA' NEI TRANSITORI DI AVVIAMENTO,SCATTO,SHUT DOWN
      RNI(10)=(ALZT-ALZTC)/100.
C--   MEMORIZZAZIONE DEI RISULTATI DELLE EQUAZIONI DIFFERENZIALI
      DATI(IPD+19)=QFUC
      DATI(IPD+22)=TFU
      DATI(IPD+23)=TOUTCX
      DATI(IPD+27)=TTERM
      DATI(IPD+28)=PCD
      DATI(IPD+29)=ALZT
      RETURN
C---  CALCOLO STAZIONARIO TURBOGAS NUOVO PIGNONE
1111  CONTINUE
      RNI(1) = (-QTG/TPOT+QTGC/TPOT)/(H0*W0)

      RNI(2)=(QFU-QFUC)/W0
      DATI(IPD+19)=QFU

      RNI(3)=(TFU-TFUCC)/T0

      RNI(4)=(TTERM-TFUCC)/T0
      DATI(IPD+23)=GSCHE*TFU
      DATI(IPD+22)=TFU
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0
      RNI(7)=(PDIFF-XIPXLOSS)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
      ELSE
C---------------------------------
C------CALCOLO TURBINA FIAT-------
C---------------------------------
C------CALCOLO POTENZA MASSIMA (W)
	QMAX=QTGNOM*TGXFF1(CTAMB)*TGXFF2(XINXLOSS)*TGXFF3(XOUTXLOSS)

C------CALCOLO POTENZA (W)
      QTGC=QMAX*TGXFF4(QC)+QTGNOM*(.5*(1.-OMEGA)*OMEGA)
C     IF(QTGC.LE.1.E4) THEN
C     QTGC=0.
C     ENDIF
C------CALCOLO PORTATA FUMI (KG/S)
C--   100%=APERTURA MASSIMA IGV TURBINA FIAT
C--   61% =APERTURA MINIMA IGV TURBINA FIAT
      QFUC=WFNOM*(TGXFF5(FTAMB)*TGXFF6(XINXLOSS)*TGXFF7(XIGV))+
     $      (FREQ-3000.)*.153

C------CALCOLO TEMPERATURA FUMI (K)
      QTGP=100.*QTGC/(QTGNOM*TGXFF2(XINXLOSS)*TGXFF3(XOUTXLOSS)*
     $       TGXFF15(XIGV))
      TFUC=(TGXFF8(QTGP,FTAMB)+TGXFF9(XINXLOSS)+
     $        TGXFF9(XOUTXLOSS))*TGXFF10(XIGV)
      TFUCC=(TFUC+306*(1.-OMEGA))+273.15
C------ CALCOLO TEMPERATURA DI RIFERIMENTO (K)
      POYX=QTGP*TGXFF15(XIGV)
C
	IF(TRIFU.EQ.1) THEN
	   TTRXC=TGXUTXFF14(POYX,FTAMB)
	ELSE
	   TTRXC=TGXFF14(POYX,FTAMB)
	ENDIF
C--   CALCOLO PRESSIONE DI SCARICO COMPRESSORE
C--   ATTENZIONE: E' STATA RICAVATA DALLA TURBINA NUOVO PIGNONE

      YGV=(54*XIGV-1600.)/38.
      PCDC=PCDN*.01*(0.32*QTGP+68.)*TGXFU15(YGV)
C--   VELOCITA' PORTATA DI COMB. POSIZIONE IGV DURANTE
C--   I TRANSITORI DI AVVIAMENTO SCATTO SHUT DOWN;
C--   DURANTE IL FUNZIONAMENTO NORMALE SONO:
      VELOC=FREQ
      QCTC=QCOM
      ALZTC=XIGV
      IF(KREGIM) GOTO 2222
C---  CALCOLO TRANSITORIO TURBOGAS FIAT
      IF(ITERT.LE.0.AND.IFUN.EQ.2) THEN
C--   RICHIAMO DEI DATI DELL'ITERAZIONE PRECEDENTE
      DATI(IPD+14)=QTG
      DATI(IPD+17)=QFU
      DATI(IPD+18)=DATI(IPD+19)
      DATI(IPD+20)=DATI(IPD+23)
      DATI(IPD+21)=DATI(IPD+22)
      ENDIF
      PX=DATI(IPD+14)
      QFS=DATI(IPD+17)
      QB=DATI(IPD+18)
      TV=DATI(IPD+20)
      TINX=DATI(IPD+21)
C--   POTENZA
      RNI(1) = (-QTG/TPOT+QTGC/TPOT)/(H0*W0)
C--   PORTATA
      QUX=QFS*EXP(-DTINT/TWFU)+.5*(QFUC+QB)*(1.-EXP(-DTINT/TWFU))
      RNI(2)=(QFU-QUX)/W0

C--   TEMPERATURA FUMI (NON E' RITARDATA)
      RNI(3)=(TFU-TFUCC)/T0
C--   TEMPERATURA MISURATA DALLE TERMOCOPPIE
      TOUTCX=TV*EXP(-DTINT/TSCHE)+.5*GSCHE*(TFUCC+TINX)*
     $         (1.-EXP(-DTINT/TSCHE))
      TC=TOUTCX+(1.-GSCHE)*TFUCC
      RNI(4)=(TTERM-TC)/T0
C--   TEMPERATURA DI RIFERIMENTO
      RNI(5)=(TTRX-TTRXC)/T0
C--   PRESSIONE DI SCARICO COMPRESSORE ASSIALE
      RNI(6)=(PCD-PCDC)/P0
C--   PERDITE DI CARICO ALL'INGRESSO
      RNI(7)=(PDIFF-XIPXLOSS)/P0
C--   VELOCITA' NEI TRANSITORI DI AVVIAMENTO,SCATTO,SHUT DOWN
      RNI(8)=(VELO-VELOC)/300.
C--   PORTATA COMBUSTIBILE NEI TRANSITORI DI AVVIAMENTO,SCATTO,SHUT DOWN
      RNI(9)=(QCT-QCTC)/100.
C--   POSIZIONE IGV NEI TRANSITORI DI AVVIAMENTO,SCATTO,SHUT DOWN
      RNI(10)=(ALZT-ALZTC)/100.
C--   MEMORIZZAZIONE DEI RISULTATI DELLE EQUAZIONI DIFFERENZIALI
      DATI(IPD+19)=QFUC
      DATI(IPD+22)=TFU
      DATI(IPD+23)=TOUTCX
      DATI(IPD+27)=TTERM
      DATI(IPD+28)=PCD
      DATI(IPD+29)=ALZT
      RETURN
C---  CALCOLO STAZIONARIO TURBOGAS FIAT
2222  CONTINUE

      RNI(1) = (-QTG/TPOT+QTGC/TPOT)/(H0*W0)
C
      RNI(2)=(QFU-QFUC)/W0
      DATI(IPD+19)=QFU
      RNI(3)=(TFU-TFUCC)/T0
      RNI(4)=(TTERM-TFUCC)/T0
      DATI(IPD+23)=GSCHE*TFU
      DATI(IPD+22)=TFU
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0

      RNI(7)=(PDIFF-XIPXLOSS)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
      ENDIF
      RETURN
      END
C--------------------------------------------------------------------
C---------- FUNZIONI DI CORREZIONE TURBOGAS NUOVO PIGNONE -----------
C--------------------------------------------------------------------
       REAL FUNCTION TGXFU1(FTAMB)                                      !SNGL
C       DOUBLE PRECISION FUNCTION TGXFU1(FTAMB)                          !DBLE
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
C--   CORREZIONE DELLA POTENZA IN FUNZIONE DELLA TEMP. AMBIENTE
C--   TGXFU1---PER UNIT
      TGXFU1=.01*(-.36735*FTAMB+121.67347)
      RETURN
      END
      REAL FUNCTION TGXFU2(XINXLOSS)                                    !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU2(XINXLOSS)                        !DBLE
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
C--   CORREZIONE DELLA POTENZA IN FUNZIONE DELLE PERDITE INGRESSO(mmH20)
C--   TGXFU2---PER UNIT
      TGXFU2=.01*(-.01575*XINXLOSS+101.4)
      RETURN
      END

      REAL FUNCTION TGXFU3(XOUTXLOSS)                                   !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU3(XOUTXLOSS)                       !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE DELLA POTENZA IN FUNZIONE DELLE PERDITE USCITA(mmH20)
C--   TGXFU3---PER UNIT
      TGXFU3=.01*(-.00591*XOUTXLOSS+100.75)
      RETURN
      END
      REAL FUNCTION TGXFU4(QTGP,FTAMB)                                  !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU4(QTGP,FTAMB)                      !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CALCOLO DELLA TEMP. USCITA IN FUNZIONE DELLA TAMB ED QTG
C--   TGXFU4---K
      PARAMETER (LDT=14,LTC=5,LUR=70)
	DIMENSION TABQ(LDT),TABTAM(LTC),TABTUF(LUR)
      DATA TABQ/-10.,0.,20.,40.,62.,71., 77.6,80.,88.6,
     $              97.,100.,110.6,121.7,130./
      DATA TABTAM/0.,30.,59.,90.,120./
      DATA TABTUF/376.,418.6,514.5,625.,763.,825.,872.,
     $      889.,954.,1020.,1044.,1132.,1228.,
     $      1302.,430.,477.,565.,675.,819.,885.,936.,
     $      955.,1026.,1099.,1126.,1226.,1336.,
     $      1423.,446.,487.,600.,730.,892.,964.,1019.,
     $      1040.,1115.,1192.,1219.,1322.,1434.,
     $      1521.,486.,524.,655.,800.,974.,1050.,1107.,
     $      1128.,1206.,1284.,1312.,1415.,1527.,
     $      1613.,526.,562.,717.,878.,1059.,1134.,
     $      1191.,1211.,1285.,1359.,1385.,1479.,
     $      1579.,1654./
      XQTG=QTGP
      IF(XQTG.LT.-10.) XQTG=-10.
      IF(XQTG.GT.131.) XQTG=131.
      IF(FTAMB.LT.0.) XTAMB=0.
      IF(FTAMB.GT.120.) FTAMB=120.
      IF(FTAMB.LT.0.) THEN
      WRITE(6,1000)
1000  FORMAT(10X,/,'TEMPERATURE IS TOO LOW IN TGXFU4')
      ENDIF
      IF(FTAMB.GT.120.) THEN
      WRITE(6,2000)
2000  FORMAT(10X,/,'TEMPERATURE IS TOO HIGH IN TGXFU4')
      ENDIF
      CALL TGLINTAB(TABTAM,LTC,TABQ,LDT,TABTUF,XQTG,FTAMB,TUFX,Z1,Z2)
      TGXFU4=TUFX
      RETURN
      END
      REAL FUNCTION TGXFU5(XINXLOSS)                                    !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU5(XINXLOSS)                        !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE DELLA TEMP. USCITA IN FUNZIONE DELLE PERDITE IN INGRESSO
C--   TGXFU5---K
      TGXFU5=.02165*XINXLOSS-1.925
      RETURN
      END
      REAL FUNCTION TGXFU6(XOUTXLOSS)                                   !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU6(XOUTXLOSS)                       !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE DELLA TEMP. USCITA IN FUNZIONE DELLE PERDITE IN USCITA
C--   TGXFU6---K
      TGXFU6=.02165*XOUTXLOSS-2.75
      RETURN
      END
      REAL FUNCTION TGXFU7(XINXLOSS)                                    !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU7(XINXLOSS)                        !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE PORTATA FUMI IN FUNZIONE DELLE PERDITE INGRESSO (mmH20)
C--   TGXFU7---PER UNIT
C--   PER LA MANCANZA DI DATI RELATIVI ALLA GRANDEZZA IN ESAME E'
C--   STATA UTILIZZATA LA FUNZIONE DI CORREZIONE DEL TURBOGAS FIAT !!
      TGXFU7=1.-.0001*(XINXLOSS-88.9)
      RETURN
      END
      REAL FUNCTION TGXFU9(QC)                                          !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU9(QC)                              !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CALCOLO DELLA POTENZA IN FUNZIONE DI QCOMB (%)
C--   TGXFU9---PER UNIT
      PARAMETER (LDT=17)
      DIMENSION TABQCOMB(LDT),TABQ(LDT)
      DATA TABQCOMB/25.,29.,30.,34.,40.,44.,48.,54.,58.,
     $                63.,70.,74.,80.,86.,90.,94.,100./
      DATA TABQ/-9.,0.,4.,12.,24.,30.,35.5,44.,50.,58.,
     $             64.,70.,77.,84.,89.,93.5,100./
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(QC-TABQCOMB(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABQ(I)-TABQ(I-1))/(TABQCOMB(I)-TABQCOMB(I-1))
      TGXFU9=0.01*(TABQ(I-1)+(QC-TABQCOMB(I-1))*DELTA)
      RETURN
      END
      REAL FUNCTION TGXFU10(QTGP,FTAMB)                                 !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU10(QTGP,FTAMB)                     !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CALCOLO DELLA TEMPERATURA DI RIFERIMENTO
      PARAMETER (LDT=13,LTC=5,LUR=65)
      DIMENSION TABQ(LDT),TABTAM(LTC),TABTRX(LUR)
      DATA TABQ/0.,20.,40.,62.,71.,77.6,80.,88.6,
     $            97.,100.,110.6,121.7,130./
      DATA TABTAM/0.,30.,59.,90.,120./
      DATA TABTRX/1295.,1238.25,1181.5,1119.08,1093.54,
     $              1074.82,1068.01,1043.61,
     $              1019.77,1011.26,981.18,949.69,926.14,
     $              1277.,1221.44,1165.89,1104.78,1079.78,
     $              1061.44,1054.78,1030.89,1007.56,
     $              999.22,969.78,938.94,915.89,
     $             1240.,1190.,1140.,1085.,1062.5,1046.,
     $              1040.,1018.5,997.5,989.3,963.5,
     $            935.75,915.,1225.,1175.68,1126.36,1072.11,
     $      1049.92,1033.65,1027.73,1006.52,
     $      985.81,978.41,952.27,924.9,904.43,
     $      1195.5,1151.45,1107.41,1058.95,1039.13,
     $      1024.6,1019.31,1000.37,981.87,
     $              975.26,951.92,927.47,909.19/
      XQTG=QTGP
      IF(XQTG.LE.62.) THEN
      XQTG=62.
      ENDIF
      CALL TGLINTAB(TABTAM,LTC,TABQ,LDT,TABTRX,XQTG,FTAMB,TR,Z1,Z2)
      TGXFU10=(TR-32.)/1.8+273.15
      RETURN
      END
      REAL FUNCTION TGXFU11(XIGV,FTAMB)                                 !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU11(XIGV,FTAMB)                     !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE DELLA PORTATA FUMI IN FUNZIONE DELLA TEMP. AMBIENTE(F)
C--   E DELLA POSIZIONE IGV (GRADI)
C--   TGXFU11---PER UNIT
      PARAMETER (LDT=11,LTC=5,LUR=55)
      DIMENSION TABXIGV(LDT),TABTAM(LTC),TABQFU(LUR)
      DATA TABXIGV/46.,51.4,56.8,62.2,67.6,73.,78.4,
     $               83.8,89.2,94.6,100./
      DATA TABTAM/0.,30.,59.,90.,120./
      DATA TABQFU/88.5,90.8,92.8,95.,97.2,99.5,101.9,
     $      104.4,107.,110.,113.2,84.9,86.6,88.4,
     $              90.2,92.2,94.3,96.4,98.6,101.,103.4,
     $              106.5,81.,82.7, 84.3,86.,87.9,89.8,
     $      91.5,93.5,95.7,97.8,100.,77.,78.4,
     $              79.7,81.1,82.6,84.1,85.7,87.4,
     $              89.2,91.1,93.1,73.,74.2,75.4,76.6,
     $              77.9,79.3,80.7,82.2,83.8,85.4,87./
      XXIGV=XIGV
      XXTAMB=FTAMB
	IF(XXIGV.LT.46.) XXIGV=46.
      IF(XXIGV.GT.100.) XXIGV=100.
      IF(XXTAMB.LT.0.) XXTAMB=0.
      IF(XXTAMB.GT.120.) XXTAMB=120.
	CALL TGLINTAB(TABTAM,LTC,TABXIGV,LDT,TABQFU,XXIGV,XXTAMB,
     $              QFUX,Z1,Z2)
      TGXFU11=.01*QFUX
      RETURN
      END
      REAL FUNCTION TGXFU15(XIGV)                                       !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU15(XIGV)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE DELLA PRESSIONE DI SCARICO DEL COMPRESSORE
      TGXFU15=(.000005083*XIGV*XIGV+.0014616*XIGV+.803)
      RETURN
      END

      REAL FUNCTION TGXFU60(FTAMB)                                      !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU60(FTAMB)                          !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE DELLA TFU AL VARIARE DI XIGV IN FUNZIONE DI TAMB
C--    TIENE CONTO DELLA DIFFERENTE INFLUENZA CHE UNA STESSA VARIAZIONE
C--   DI POSIZIONE DELL'IGV HA SULLA TEMPERATURA DEI FUMI A DIVERSI
C--   VALORI DELLA TEMPERATURA AMBIENTE
      TGXFU60=-.001872*FTAMB*FTAMB-.70572*FTAMB+48.
      RETURN
      END
      REAL FUNCTION TGXFU70(POXG)                                       !SNGL
C      DOUBLE PRECISION FUNCTION TGXFU70(POXG)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE SULLA  TFU IN FUNZIONE DEL CARICO ATTUALE RISPETTO A
C--     QUELLO MASSIMO
C--   UNA VARIAZIONE DELLA POSIZIONE DELL'IGV HA UN DIVERSO
C--   EFFETTO SULLA TEMPERATURA DEI FUMI A SECONDA DEL VALORE
C--   DELLA POTENZA
C--   TGXFU70---PER UNIT
      TGXFU70=.6055555*POXG*POXG+.13055555*POXG+.26388
      RETURN
      END
C----------------------------------------------------------------
C---------------- FUNZIONI DI CORREZIONE TURBOGAS FIAT ----------
C----------------------------------------------------------------

      REAL FUNCTION TGXFF1(CTAMB)                                       !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF1(CTAMB)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE DELLA POTENZA IN FUNZIONE DELLA TEMP. AMBIENTE (C)
C--   TGXFF1---PER UNIT
      TGXFF1=.01*(109.8571-.6571*CTAMB)
      RETURN
      END
      REAL FUNCTION TGXFF2(XINXLOSS)                                    !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF2(XINXLOSS)                        !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE DELLA POTENZA IN FUNZIONE DELLE PERDITE INGRESSO(mmH20)
C--   TGXFF2---PER UNIT
      TGXFF2=1.-.000162*XINXLOSS
      RETURN
      END
      REAL FUNCTION TGXFF3(XOUTXLOSS)                                   !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF3(XOUTXLOSS)                       !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE DELLA POTENZA IN FUNZIONE DELLE PERDITE USCITA (mmH20)
C--   TGXFF3---PER UNIT
      TGXFF3=1.-.000064*XOUTXLOSS
      RETURN
      END
      REAL FUNCTION TGXFF4(QC)                                          !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF4(QC)                              !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CALCOLO DELLA QPOENZA IN FUNZIONE DELLA PORTATA COMB. (%)
C--   TGXFF4---PER UNIT
      PARAMETER (LDT=17)
      DIMENSION TABQCOMB (LDT),TABQ(LDT)
      DATA TABQCOMB/24.,29.,30.,35.,40.,45.,50.,55.,60.,
     $        65.,70.,75.,80.,85.,90.,95.,100./
      DATA TABQ/-8.,0.,2.,10.,18.,26.,35.,41.,47.,55.,
     $              61.,68.,74.,81.,87.,93.,100./
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(QC-TABQCOMB(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABQ(I)-TABQ(I-1))/(TABQCOMB(I)-TABQCOMB(I-1))
      TGXFF4=0.01*(TABQ(I-1)+(QC-TABQCOMB(I-1))*DELTA)
      RETURN
      END
      REAL FUNCTION TGXFF5(FTAMB)                                       !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF5(FTAMB)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE DELLA PORTATA FUMI IN FUNZIONE DI TEMP. AMBIENTE (F)
C--   TGXFF5---PER UNIT
      TGXFF5=.01*(-.0004143*FTAMB*FTAMB-.17418*FTAMB+111.7151)
      RETURN
      END
      REAL FUNCTION TGXFF6(XINXLOSS)                                    !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF6(XINXLOSS)                        !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CORREZIONE PORTATA FUMI IN FUNZIONE DELLE PERDITE INGRESSO (mmH20)
C--   TGXFF6---PER UNIT
      TGXFF6=1.-.0001*XINXLOSS
      RETURN
      END
      REAL FUNCTION TGXFF7(XIGV)                                        !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF7(XIGV)                            !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE DELLA PORTATA FUMI IN FUNZIONE DELL'IGV (%)
C--   TGXFF7---PER UNIT
      RAD=39.154*XIGV-2388.394
      IF(RAD.LE.0.) THEN
      RAD=0.
      XIGV=61.
      ENDIF
      TGXFF7=.01*(60.923+SQRT(RAD))
      RETURN
      END
      REAL FUNCTION TGXFF8(QTGP,FTAMB)                                  !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF8(QTGP,FTAMB)                      !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CALCOLO TEMPERATURA FUMI
      PARAMETER (LDT=14,LTC=7,LUR=98)
      DIMENSION TABQ(LDT),TABTAM(LTC),TABTUF(LUR)
      DATA TABQ/-10.,0.,20.,40.,60.,80.,100.,120.,
     $              140.,160.,180.,200.,220.,240./
      DATA TABTAM/0.,20.,40.,59.,80.,100.,120./
      DATA TABTUF/180.,200.,238.,278.,322.,369.,419.,472.,
     $              528.,588.,650.,716.,784.,856.,195.,
     $              214.,253.,295.,340.,389.,441.,496.,
     $              555.,617.,682.,751.,823.,898.,205.,
     $              228.,268.,312.,360.,411.,466.,524.,
     $              586.,651.,720.,792.,868.,948.,220.,
     $              242.,285.,332.,382.,436.,495.,554.,
     $              618.,686.,758.,833.,912.,994.,235.,
     $              258.,305.,356.,410.,467.,527.,590.,
     $              656.,726.,798.,874.,952.,1034.,250.,
     $              274.,325.,379.,436.,496.,560.,626.,
     $              696.,768.,844.,923.,1005.,1090.,265.,
     $              290.,348.,408.,470.,534.,601.,670.,
     $              741.,814.,890.,968.,1048.,1130./
      XQTG=QTGP
      IF(XQTG.LT.-10.) XQTG=-10.
      IF(XQTG.GT.241.) XQTG=241.
      IF(FTAMB.LT.0.) XTAMB=0.
      IF(FTAMB.GT.120.) FTAMB=120.
      CALL TGLINTAB(TABTAM,LTC,TABQ,LDT,TABTUF,XQTG,FTAMB,TUF,Z1,Z2)
      TGXFF8=TUF
      RETURN
      END
      REAL FUNCTION TGXFF9(XXLOSS)                                      !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF9(XXLOSS)                          !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE TEMP. FUMI IN FUNZIONE DELLE PERDITE (mmH20)
C--   TGXFF9---K
      TGXFF9=.0156*XXLOSS
      RETURN
      END
      REAL FUNCTION TGXFF10(XIGV)                                       !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF10(XIGV)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE TEMP. FUMI IN FUNZIONE DELL'IGV (%)
C--   TGXFF10---PER UNIT
      TGXFF10=.01*(.0044346*XIGV*XIGV-.9332*XIGV+148.9746)
      RETURN
      END

      REAL FUNCTION TGXFF14(POYX,FTAMB)                                 !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF14(POYX,FTAMB)                     !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CALCOLO TEMPERATURA DI RIFERIMENTO
      PARAMETER (LDT=14,LTC=7,LUR=98)
      DIMENSION TABQ(LDT),TABTAM(LTC),TABTRX(LUR)
      DATA TABQ/42.,46.,49.9,54.1,57.8,61.7,65.7,
     $       77.7,85.,92.3,100.,106.9,114.2,121.5/
      DATA TABTAM/0.,20.,40.,59.,80.,100.,120./
      DATA TABTRX/534.,531.,528.,525.,523.,520.,517.,
     $      508.,503.,497.,492.,487.,481.,476.,
     $      536.,533.,530.,527.,524.,521.,518.,
     $      508.,503.,497.,491.,486.,480.,474.,
     $      541.,538.,534.,531.,528.,524.,521.,
     $      511.,505.,499.,492.,486.,480.,474.,
     $      550.,546.,542.,538.,535.,531.,527.,
     $      516.,509.,502.,495.,488.,482.,475.,
     $      555.,551.,547.,543.,539.,535.,531.,
     $      519.,511.,504.,496.,489.,482.,474.,
     $      560.,556.,551.,547.,542.,538.,534.,
     $      520.,512.,504.,495.,487.,479.,471.,
     $      572.,567.,562.,557.,552.,547.,542.,
     $      527.,518.,508.,499.,490.,481.,472./
      XQTG=POYX
      CALL TGLINTAB(TABTAM,LTC,TABQ,LDT,TABTRX,XQTG,FTAMB,TR,Z1,Z2)
      TGXFF14=TR+273.15
      RETURN
      END
      REAL FUNCTION TGXFF15(XIGV)                                       !SNGL
C      DOUBLE PRECISION FUNCTION TGXFF15(XIGV)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--     CORREZIONE POTENZA IN FUNZIONE DELL'IGV (%)
      RAD=54.585*XIGV-3329.685
      IF(RAD.LE.0.) THEN
      RAD=0.
      XIGV=61.
      ENDIF
      TGXFF15=.01*(54.070+SQRT(RAD))
      RETURN
      END
C
C-------SUBROUTINES PER L'INTERPOLAZIONE ------------
C
      SUBROUTINE TGLINTAB(TABP,LP,TABX,LX,TABY,X,P,Y,DYX,DYP)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      DIMENSION TABP(*),TABX(*),TABY(*)
      LP1=LP-1
      DO 10 I=2,LP1
      IF(P-TABP(I)) 20,20,10
10    CONTINUE
      I=LP
20    IP=LX*(I-2)+1
      CALL TGLININT(TABX,LX,TABY(IP),X,Y1,DYX1)
      IP=IP+LX
      CALL TGLININT(TABX,LX,TABY(IP),X,Y2,DYX2)
      DYP=(Y2-Y1)/(TABP(I)-TABP(I-1))
      Y=Y1+(P-TABP(I-1))*DYP
      DYX=DYX1+(P-TABP(I-1))*(DYX2-DYX1)/(TABP(I)-TABP(I-1))
      RETURN
      END
      SUBROUTINE TGLININT(TABX,LX,TABY,X,Y,DYX)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
      DIMENSION TABX(*),TABY(*)
      LX1=LX-1
      DO 10 I=2,LX1
      IF(X-TABX(I)) 20,20,10
10    CONTINUE
      I=LX
20    DYX=(TABY(I)-TABY(I-1))/(TABX(I)-TABX(I-1))
      Y=TABY(I-1)+(X-TABX(I-1))*DYX
      RETURN
      END
C--------------------------------------------
C-----  SUBROUTINE AVVIAMENTO TURBOGAS -----
C--------------------------------------------
      SUBROUTINE TURGAVVI(IFUN,IXYU,XYU,IPD,DATI,RNI)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
	DIMENSION XYU(*),DATI(*),RNI(*)
      COMMON/NORM/P0,H0,T0,W0,RO0,AL0,V0,DP0
      COMMON/INTEGR/TSTOP,TEMPO,DTINT,NPAS,CDT                          !SNGL
C      COMMON/INTEG1/TSTOP,TEMPO,DTINT,CDT,ALFADT,NPAS                   !DBLE
      COMMON/PARPAR/NUL(7),ITERT
      LOGICAL KREGIM
      COMMON/REGIME/KREGIM
      INTEGER K
      INTEGER SC, SD
      REAL K22
C
      Q0=H0*W0
      QTG = XYU(IXYU  )*Q0
      QFU = XYU(IXYU+1)*W0
      TFU = XYU(IXYU+2)*T0
      TTERM = XYU(IXYU+3)*T0
      TTRX = XYU(IXYU+4)*T0
      PCD = XYU(IXYU+5)*P0
      PDIFF =XYU(IXYU+6)*P0
      VELO = XYU(IXYU+7)*300.
      QCT = XYU(IXYU+8)*100.
      ALZT = XYU(IXYU+9)*100.
      XIGV = XYU(IXYU+10)*100.
      QCOM  = XYU(IXYU+11)*100.
      TAMB = XYU(IXYU+12)*T0
      FREQ = XYU(IXYU+13)*300.
      AV = XYU(IXYU+14)*1.
      SC = XYU(IXYU+15)*1.
      SD = XYU(IXYU+16)*1.
      AKIN = DATI(IPD  )
      WFNOM = DATI(IPD+2)
      QTGNOM = DATI(IPD+3)
      TIPO = DATI(IPD+4)
      TFOUT = DATI(IPD+5)
      K =DATI(IPD+25)
      T1=DATI(IPD+26)
      GSCHE=DATI(IPD+32)
C
      IF(AV.EQ.2.) GOTO 3333
      IF(KREGIM) GOTO 3333
C-------CALCOLO TRANSITORIO AVVIAMENTO
C      IF(K.EQ.0) THEN
C      T1=TEMPO
C      DATI(IPD+26)=T1
C      DATI(IPD+25)=1
C      ENDIF
C
C---- MODIFICHE PER AVVIAMENTO E SPEGNIMENTO RIPETUTI
C !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      DTAV=DATI(IPD+37)
      IF(ITERT.LE.0.AND.IFUN.EQ.2) THEN
      K22=DATI(IPD+37)
      DTAV=DTINT+K22
      DATI(IPD+37)=DTAV
      DTSH=0.
      DTSC=0.
      DATI(IPD+36)=DTSH
      DATI(IPD+38)=DTSC
      ENDIF
C !!!!!!!!!!!!!!!!!!!!!!!!!
C
      FTAMB=(TAMB-273.15)*1.8+32.
      QTGC=0.
C      DT=TEMPO-T1

      IF(TIPO.EQ.1.) THEN
C--     CALCOLO PORTATA FUMI AVVIAMENTO NP
      QFUC=(WFNOM*TGXFU11(46.,FTAMB))/3000.*VELO
C--   TEMPERATURA DI RIFERIMENTO NP
      TTRXC=858.15
C--   TEMPERATURA DEI FUMI NP
      TFUC=TGXFA3(DTAV)
      ELSE
C--     CALCOLO PORTATA FUMI AVVIAMENTO FIAT
      QFUC=(WFNOM*TGXFF5(FTAMB)*TGXFF6(XINXLOSS)*
     $        TGXFF7(62.))/3000.*VELO
C--   TEMPERATURA DI RIFERIMENTO FIAT
      TTRXC=865.15
C--   TEMPERATURA FUMI FIAT
      TFUC=TGXFX1(DTAV)
      ENDIF
C--   PRESSIONE SCARICO COMPRESSORE ASSIALE
      PCDC=.62488E6*VELO*VELO/9000000.+1.E5
C--   CALCOLO PERDITE
      DATA RGAS/287./
      ROIN=1.E5/(RGAS*TAMB)
      XIPXLOSS=AKIN*QFU*QFU/ROIN
      PDIFFC=XIPXLOSS
C--   VELOCITA' AVVIAMENTO
      VELOC=TGXFA1(DTAV)
C---GUAG 26 NOV 1991
C      IF((VELOC.GE.FREQ).AND.(TIPO.EQ.1)) THEN
C      VELOC=FREQ
C      TFUC=523.98
C      ENDIF
C      IF((VELOC.GE.FREQ).AND.(TIPO.NE.1)) THEN
C      VELOC=FREQ
C      TFUC=534.9
C      ENDIF
      DATA FREQSET/3000./
      IF((VELOC.GE.FREQSET).AND.(TIPO.EQ.1)) THEN
      VELOC=FREQSET
      TFUC=523.98
      ENDIF
      IF((VELOC.GE.FREQSET).AND.(TIPO.NE.1)) THEN
      VELOC=FREQSET
      TFUC=534.9
      ENDIF
C---GUAG 26 NOV 1991

C--   PORTATA COMBUSTIBILE ALL'AVVIAMENTO
      QCTC=TGXFA2(VELO)
C--   APERTURA DELL'IGV ALL'AVVIAMENTO
C     SDDTAV=770.  ! e` stato accorciato il tempo di lavaggio di 260 sec.
      SDDTAV=510.
      IF(DTAV.LT.SDDTAV) THEN
      ALZTC=0.
      ELSE
      ALZTC=1.35*(DTAV-SDDTAV)
      ENDIF
      IF((ALZTC.GT.46.).AND.(TIPO.EQ.1)) THEN
      ALZTC=46.
      ENDIF
      IF((ALZTC.GT.62.).AND.(TIPO.NE.1.)) THEN
      ALZTC=62.
      ENDIF

      GUAD=1.E-8
      RNI(1) =(- QTG/.2+QTGC/.2*GUAD)/(H0*W0)
      RNI(2)=(QFU-QFUC)/W0
      RNI(3)=(TFU-TFUC)/T0
      RNI(4)=(TTERM-TFUC)/T0
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0
      RNI(7)=(PDIFF-PDIFFC)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
C--   MEMORIZZAZIONE NEL VETTORE DATI PER LA RISOLUZIONE
C--   DELLE EQUAZIONI DIFFERENZIALI DEL TRANSITORIO NORMALE
      DATI(IPD+9)=29.
      DATI(IPD+11)=VELO/3000.
      DATI(IPD+13)=29.
      DATI(IPD+16)=VELO/3000.
      DATI(IPD+19)=QFU
      DATI(IPD+23)=GSCHE*TFU
      DATI(IPD+22)=TFU
      RETURN

 3333   CONTINUE

C-------CALCOLO STAZIONARIO AVVIAMENTO
      GUAD=1.E-8
      RNI(1) =(-QTG/.2+QTGC/.2*GUAD)/(H0*W0)
      QFUC=0.
      TFUC=TAMB
      IF(TIPO.EQ.1.) THEN
      TTRXC=858.15
      ELSE
      TTRXC=865.15
      ENDIF
      PCDC=1.E5
      PDIFFC=0.
      VELOC=0.
      QCTC=0.
      ALZTC=0.
      RNI(2)=(QFU-QFUC)/W0
      RNI(3)=(TFU-TFUC)/T0
      RNI(4)=(TTERM-TFUC)/T0
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0
      RNI(7)=(PDIFF-PDIFFC)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
      RETURN
      END
C--------------------------------------------------
C--   SUBROUTINE PER LO SHUT DOWN----------------
C--------------------------------------------------
      SUBROUTINE TURGSHUD(IFUN,IXYU,XYU,IPD,DATI,RNI)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
	DIMENSION XYU(*),DATI(*),RNI(*)
      COMMON/NORM/P0,H0,T0,W0,RO0,AL0,V0,DP0
      COMMON/INTEGR/TSTOP,TEMPO,DTINT,NPAS,CDT                          !SNGL
C      COMMON/INTEG1/TSTOP,TEMPO,DTINT,CDT,ALFADT,NPAS                   !DBLE
      COMMON/PARPAR/NUL(7),ITERT
      LOGICAL KREGIM
      COMMON/REGIME/KREGIM
      INTEGER K
      INTEGER SC, SD
      REAL DTSH,K2
C
      Q0=H0*W0
      QTG = XYU(IXYU  )*Q0
      QFU = XYU(IXYU+1)*W0
      TFU = XYU(IXYU+2)*T0
      TTERM = XYU(IXYU+3)*T0
      TTRX = XYU(IXYU+4)*T0
      PCD = XYU(IXYU+5)*P0
      PDIFF =XYU(IXYU+6)*P0
      VELO = XYU(IXYU+7)*300.
      QCT = XYU(IXYU+8)*100.
      ALZT = XYU(IXYU+9)*100.
      XIGV = XYU(IXYU+10)*100.
      QCOM  = XYU(IXYU+11)*100.
      TAMB = XYU(IXYU+12)*T0
      FREQ = XYU(IXYU+13)*300.
      AV = XYU(IXYU+14)*1.
      SC = XYU(IXYU+15)*1.
      SD = XYU(IXYU+16)*1.
      AKIN = DATI(IPD  )
      WFNOM = DATI(IPD+2)
      QTGNOM = DATI(IPD+3)
      TIPO = DATI(IPD+4)
      TFOUT = DATI(IPD+5)
      K=DATI(IPD+25)
      T1=DATI(IPD+26)
      IF(KREGIM) GOTO 4444
C--   CALCOLO TRANSITORIO DI SPEGNIMENTO
C     MODIFICHE PER AVVIAMENTO E SPEGNIMENTO RIPETUTI
C******************************** 24/10/91
      DTSH=DATI(IPD+36)
      IF((ITERT.LE.0).AND.(IFUN.EQ.2)) THEN
	K2=DATI(IPD+36)
	DTSH=DTINT + K2
	DATI(IPD+36)=DTSH
	DTAV=0.
	DTSC=0.
	DATI(IPD+37)=DTAV
	DATI(IPD+38)=DTSC
      ENDIF
C******************************** 23/7/91
      IF(K.EQ.0) THEN
C      T1=TEMPO
C      DATI(IPD+26)=T1
C******************************** 5/7/90
	K=1
      DATI(IPD+25)=K
C******************************** 5/7/90
      ENDIF
      FTAMB=(TAMB-273.15)*1.8+32.
      QTGC=0.
C      DT=TEMPO-T1
      IF(TIPO.EQ.1.) THEN
C--     CALCOLO PORTATA FUMI SPEGNIMENTO NP
      QFUC=(WFNOM*TGXFU11(46.,FTAMB))/3000.*VELO
C--   TEMPERATURA RIFERIMENTO NP DURANTE LO SPEGNIMENTO
      TTRXC=858.15
C--   TEMPERATURA DEI FUMI NP DURANTE LO SPEGNIMENTO
      TFUC=523.79*TGXFS3(DTSH)
      SDTSH=540.
	IF(DTSH.GT.SDTSH) THEN
	  TFUC=288.15+78.503*EXP(-(DTSH-SDTSH)/1000.)
	ENDIF
      ELSE
C--     CALCOLO PORTATA FUMI SPEGNIMENTO FIAT
      QFUC=(WFNOM*TGXFF5(FTAMB)*TGXFF6(XINXLOSS)*
     $        TGXFF7(62.))/3000.*VELO
C--   TEMPERATURA DI RIFERIMENTO FIAT
      TTRXC=865.15
C--   TEMPERATURA DEI FUMI FIAT
      TFUC=534.9*TGXFS3(DTSH)
      SDTSH=540.
      IF(DTSH.GT.SDTSH) THEN
      TFUC=288.15+86.28*EXP(-(DTSH-SDTSH)/1000.)
      ENDIF
      ENDIF
C--   PRESSIONE DI SCARICO DEL COMPRESSORE ASSIALE
      PCDC=.62488E6*VELO*VELO/9000000.+1.E5
C--   PERDITE ALL'ASPIRAZIONE
      DATA RGAS/287./
      ROIN=1.E5/(RGAS*TAMB)
      XIPXLOSS=AKIN*QFU*QFU/ROIN
      PDIFFC=XIPXLOSS
C--   VELOCITA' DURANTE LO SPEGNIMENTO
      VELOC= FREQ*TGXFS1(DTSH)
      IF(VELOC.LE.0.) THEN
      VELOC=0.
      ENDIF
C--     CALCOLO COMBUSTIBILE NELLO SPEGNIMENTO
C******************************** 5/7/90
	IF(K.EQ.0) THEN
	      QCTC=QCOM
C
      ELSE
	      IF((DTSH.GT.0.).AND.(DTSH.LE.270.)) THEN
       QCTC=26.7
	      ENDIF
       IF(DTSH.GT.270.) THEN
	QCTC=0.
       ENDIF
      ENDIF
C******************************** 5/7/90

C--   APERTURA DELL'IGV DURANTE LO SPEGNIMENTO
	IF(TIPO.EQ.1.) THEN
	ALZTC=(-46.*DTSH+1380.)/20.
	ELSE
	ALZTC=(-62.*DTSH+1860.)/20.
	ENDIF
      IF((DTSH.LT.10.).AND.(TIPO.EQ.1)) THEN
      ALZTC=46.
	ENDIF
	IF((DTSH.LE.10.).AND.(TIPO.NE.1.)) THEN
	ALZTC=62.
	ENDIF

      IF(DTSH.GE.30.) THEN
	ALZTC=0.
	ENDIF

      GUAD=1.E-8
      RNI(1) =(-QTG/.2+QTGC/.2*GUAD)/(H0*W0)
      RNI(2)=(QFU-QFUC)/W0
      RNI(3)=(TFU-TFUC)/T0
      RNI(4)=(TTERM-TFUC)/T0
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0
      RNI(7)=(PDIFF-PDIFFC)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
      RETURN
4444  CONTINUE
C--   CALCOLO STAZIONARIO PER LO SPEGNIMENTO
      QTGC=0.
      IF(TIPO.EQ.1.) THEN
      TTRXC=858.15
      TFUC=523.79
      QFUC=(WFNOM*TGXFU11(46.,FTAMB))/3000.*VELO
      ALZTC=46.
      ELSE
      TTRXC=865.15
      TFUC=534.9
      QFUC=(WFNOM*TGXFF5(FTAMB)*TGXFF6(XINXLOSS)*
     $        TGXFF7(62.))/3000.*VELO
      ALZTC=62.
      ENDIF
      PCDC=0.62488E6
      ROIN=1.E5/(RGAS*TAMB)
      XIPXLOSS=AKIN*QFU*QFU/ROIN
      PDIFFC=XIPXLOSS
      VELOC=3000.
      QCTC=29.
      GUAD=1.E-8
      RNI(1) =(-QTG/.2+QTGC/.2*GUAD)/(H0*W0)
      RNI(2)=(QFU-QFUC)/W0
      RNI(3)=(TFU-TFUC)/T0
      RNI(4)=(TTERM-TFUC)/T0
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0
      RNI(7)=(PDIFF-PDIFFC)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
      RETURN
      END
C--------------------------------------------
C--   SUBROUTINE PER LO SCATTO-------------
C-------------------------------------------
      SUBROUTINE TURGSCAT(IFUN,IXYU,XYU,IPD,DATI,RNI)
C       IMPLICIT DOUBLE PRECISION (A-H, O-Z)                             !DBLE
	DIMENSION XYU(*),DATI(*),RNI(*)
      COMMON/NORM/P0,H0,T0,W0,RO0,AL0,V0,DP0
      COMMON/INTEGR/TSTOP,TEMPO,DTINT,NPAS,CDT                          !SNGL
C      COMMON/INTEG1/TSTOP,TEMPO,DTINT,CDT,ALFADT,NPAS                   !DBLE
      COMMON/PARPAR/NUL(7),ITERT
      LOGICAL KREGIM
      COMMON/REGIME/KREGIM
      INTEGER K
      INTEGER SC, SD
      REAL DTSC,DTSH,DTAV,K3
C
      Q0=H0*W0
      QTG = XYU(IXYU  )*Q0
      QFU = XYU(IXYU+1)*W0
      TFU = XYU(IXYU+2)*T0
      TTERM = XYU(IXYU+3)*T0
      TTRX = XYU(IXYU+4)*T0
      PCD = XYU(IXYU+5)*P0
      PDIFF =XYU(IXYU+6)*P0
      VELO = XYU(IXYU+7)*300.
      QCT = XYU(IXYU+8)*100.
      ALZT = XYU(IXYU+9)*100.
      XIGV = XYU(IXYU+10)*100.
      QCOM  = XYU(IXYU+11)*100.
      TAMB = XYU(IXYU+12)*T0
      FREQ = XYU(IXYU+13)*300.
      AV = XYU(IXYU+14)*1.
      SC = XYU(IXYU+15)*1.
      SD = XYU(IXYU+16)*1.
      AKIN = DATI(IPD  )
      WFNOM = DATI(IPD+2)
      QTGNOM = DATI(IPD+3)
      TIPO = DATI(IPD+4)
      TFOUT = DATI(IPD+5)
      K=DATI(IPD+25)
      T1=DATI(IPD+26)
      TERM=DATI(IPD+27)
      TFUMI=DATI(IPD+22)
      QFUMI=DATI(IPD+17)
      PCDP=DATI(IPD+28)
      ALZS=DATI(IPD+29)

C--   CALCOLO TRANSITORIO DI SCATTO
C      IF(K.EQ.0) THEN
C      T1=TEMPO
C      DATI(IPD+26)=T1
C      DATI(IPD+25)=1
C      ENDIF
C
C     MODIFICHE PER AVVIAMENTO E SPEGNIMENTO RIPETUTI
C******************************** 24/10/91
      DTSC=DATI(IPD+38)
      IF((ITERT.LE.0).AND.(IFUN.EQ.2)) THEN
	K3=DATI(IPD+38)
	DTSC=DTINT + K3
	DATI(IPD+38)=DTSC
	DTAV=0.
	DTSH=0.
	DATI(IPD+37)=DTAV
	DATI(IPD+36)=DTSH
      ENDIF
C******************************** 23/7/91
C
      FTAMB=(TAMB-273.15)*1.8+32.
      QTGC=0.
C      DT=TEMPO-T1

      IF(TIPO.EQ.1.) THEN
C--     CALCOLO PORTATA FUMI SCATTO NP
	QFUC =QFUMI/FREQ*VELO
C$PROTEZIONE
      IF(QFUC.LE.5.)QFUC=5.
C--   TEMPERATURA DI RIFERIMENTO SCATTO NP
      TTRXC=858.15
C--   TEMPERATURA DEI FUMI DURANTE LO SCATTO NP
      TFUC=288.15+(TFUMI-288.15)*EXP(-DTSC/500.)
      TTERMC=288.15+(TERM-288.15)*EXP(-DTSC/500.)
      ELSE
C--     CALCOLO PORTATA FUMI SCATTO FIAT
      QFUC=QFUMI/FREQ*VELO
C$PROTEZIONE
      IF(QFUC.LE.5.)QFUC=5.
C--   TEMPERATURA DI RIFERIMENTO SCATTO FIAT
      TTRXC=865.15
C--   TEMPERATURA FUMI SCATTO FIAT
      TFUC=288.15+(TFUMI-288.15)*EXP(-DTSC/500.)
      TTERMC=288.15+(TERM-288.15)*EXP(-DTSC/500.)
      ENDIF
C--   PRESSIONE SCARICO COMPRESSORE ASSIALE
      PCDC=(PCDP-1.E5)*VELO*VELO/(2.*FREQ*FREQ)+1.E5
C--   PERDITE DI CARICO ALL'ASPIRAZIONE
      DATA RGAS/287./
      ROIN=1.E5/(RGAS*TAMB)
      XIPXLOSS=AKIN*QFU*QFU/ROIN
      PDIFFC=XIPXLOSS
C--   VELOCITA' SCATTO
      VELOC=FREQ*TGXFSC2(DTSC)
      IF(VELOC.LE.0.) THEN
      VELOC=0.
      ENDIF
C--   PORATATA COMB SCATTO
      QCTC=0.
C--   POSIZIONE IGV SCATTO
      ALZTC=ALZS-8.*DTSC
      IF(ALZTC.LE.0.) THEN
      ALZTC=0.
      ENDIF

      QTGC=0.
      RNI(1) =(-QTG/.6+QTGC/.6)/(H0*W0)
      RNI(2)=(QFU-QFUC)/W0
      RNI(3)=(TFU-TFUC)/T0
      RNI(4)=(TTERM-TTERMC)/T0
      RNI(5)=(TTRX-TTRXC)/T0
      RNI(6)=(PCD-PCDC)/P0
      RNI(7)=(PDIFF-PDIFFC)/P0
      RNI(8)=(VELO-VELOC)/300.
      RNI(9)=(QCT-QCTC)/100.
      RNI(10)=(ALZT-ALZTC)/100.
      RETURN
      END
C---------------------------------------------------------
C-------FUNZIONI PER LA DESCRIZIONE DELL'AVVIAMENTO-------
C---------------------------------------------------------
      REAL FUNCTION TGXFA1(DUR)                                         !SNGL
C      DOUBLE PRECISION FUNCTION TGXFA1(DUR)                             !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   VELOCITA' DURANTE L'AVVIAMENTO
      PARAMETER (LDT=13)
      DIMENSION TABTEMPO(LDT),TABVELO(LDT)
C      DATA TABTEMPO/0.,30.,55.,60.,90.,200.,400.,
C     $                560.,600.,660.,720.,780.,804./
      DATA TABTEMPO/0.,30.,55.,60.,90.,200.,250.,
     $                300.,340.,400.,460.,520.,544./
      DATA TABVELO/0.,337.,562.,560.,525.,525.,525.,
     $              525.,862.,1200.,1875.,2700.,3000./
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(DUR-TABTEMPO(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABVELO(I)-TABVELO(I-1))/(TABTEMPO(I)-TABTEMPO(I-1))
      TGXFA1=(TABVELO(I-1)+(DUR-TABTEMPO(I-1))*DELTA)
      RETURN
      END

      REAL FUNCTION TGXFA2(VELO)                                        !SNGL
C      DOUBLE PRECISION FUNCTION TGXFA2(VELO)                            !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   PORTATA DI COMBUSTIBILE ALL'AVVIAMENTO
      PARAMETER (LDT=11)
      DIMENSION TABVELO(LDT),TABCOMB(LDT)
      DATA TABVELO/0.,580.,590.,600.,1200.,2250.,
     $               2310.,2775.,2850.,2940.,3000./
      DATA TABCOMB/0.,0.,28.,7.7,12.,28.,26.,
     $              33.,32.,34.,29./
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(VELO-TABVELO(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABCOMB(I)-TABCOMB(I-1))/(TABVELO(I)-TABVELO(I-1))
      TGXFA2=(TABCOMB(I-1)+(VELO-TABVELO(I-1))*DELTA)
      RETURN
      END
      REAL FUNCTION TGXFA3(DUR)                                         !SNGL
C      DOUBLE PRECISION FUNCTION TGXFA3(DUR)                             !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   TEMPERATURA DEI FUMI TURBINA NUOVO PIGNONE ALL'AVVIAMENTO
      PARAMETER (LDT=11)
      DIMENSION TABTEMPO(LDT),TABTFU(LDT)
C      DATA TABTEMPO/0.,560.,590.,622.,653.,685.,
C     $                716.,747.,766.,778.,804./
      DATA TABTEMPO/0.,300.,330.,362.,393.,425.,
     $                456.,487.,506.,518.,544./
      DATA TABTFU/288.15,310.15,425.,491.,531.,623.,
     $             678.,704.,714.,709.,523.98/
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(DUR-TABTEMPO(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABTFU(I)-TABTFU(I-1))/(TABTEMPO(I)-TABTEMPO(I-1))
      TGXFA3=(TABTFU(I-1)+(DUR-TABTEMPO(I-1))*DELTA)
      RETURN
      END
      REAL FUNCTION TGXFX1(DUR)                                         !SNGL
C      DOUBLE PRECISION FUNCTION TGXFX1(DUR)                             !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   TEMPERATURA DEI FUMI TURBINA FIAT ALL'AVVIAMENTO
      PARAMETER (LDT=11)
      DIMENSION TABTEMPO(LDT),TABTUF(LDT)
      DATA TABTEMPO/0.,560.,590.,622.,653.,685.,
     $                716.,747.,766.,778.,804./
      DATA TABTUF/288.15,318.15,435.,481.,537.,623.,
     $             678.,704.,714.,709.,534.9/
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(DUR-TABTEMPO(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABTUF(I)-TABTUF(I-1))/(TABTEMPO(I)-TABTEMPO(I-1))
      TGXFX1=(TABTUF(I-1)+(DUR-TABTEMPO(I-1))*DELTA)
      RETURN
      END

C----------------------------------------------------------
C-------FUNZIONI PER LA DESCRIZIONE DELLO SHUT DOWN--------
C----------------------------------------------------------

      REAL FUNCTION TGXFS3(DUR)                                         !SNGL
C      DOUBLE PRECISION FUNCTION TGXFS3(DUR)                             !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C---    CALCOLO TEMPERATURA FUMI SPEGNIMENTO
      PARAMETER (LDT=30)
      DIMENSION TBTEMP(LDT),TABTUF(LDT)
      DATA TBTEMP/0.,20.,35.,40.,60.,80.,100.,
     $                120.,140.,160.,180.,200.,220.,
     $                240.,260.,270.,280.,300.,320.,
     $                340.,360.,380.,400.,420.,440.,
     $                460.,480.,500.,520.,540./
C      DATA TABTUF/100.,103.,123.52,123.53,132.35,
C     $             138.23,144.1,151.47,158.2,162.,
C     $              166.1,170.5,173.52,175.8,176.6,
C     $              177.94,154.4,129.4,114.7,105.,
C     $              100.,97.05,94.1,88.2,85.,82.,
C     $              79.,76.,73.,70./
      DATA TABTUF/100.,98.,97.,96.,95.,
     $             94.,93.,92.,91.,90.,
     $             89.,88.,87.,86.,85.,
     $             84.,83.,82.,81.,80.,
     $             79.,78.,77.,76.,75.,
     $             74.,73.,72.,71.,70./
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(DUR-TBTEMP(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABTUF(I)-TABTUF(I-1))/(TBTEMP(I)-TBTEMP(I-1))
      TGXFS3=.01*(TABTUF(I-1)+(DUR-TBTEMP(I-1))*DELTA)
      RETURN
      END
	REAL FUNCTION TGXFS1(DUR)                                       !SNGL
C        DOUBLE PRECISION FUNCTION TGXFS1(DUR)                           !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   VELOCITA' DURANTE LO SPEGNIMENTO
      PARAMETER (LDT=25)
      DIMENSION TABTEMPO(LDT),TABVELO(LDT)
      DATA TABTEMPO/0.,20.,40.,60.,80.,100.,120.,
     $                140.,160.,180.,200.,220.,240.,
     $               260.,280.,300.,320.,340.,360.,
     $                380.,400.,420.,440.,460.,
     $                540./
      DATA TABVELO/1.,.862,.818,.775,.733,.7,.668,
     $              .631,.59,.562,.525,.475,.4623,
     $               .425,.362,.325,.275,.243,.225,
     $               .197,.17,.148,.123,.09986,0./
     $
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(DUR-TABTEMPO(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABVELO(I)-TABVELO(I-1))/(TABTEMPO(I)-TABTEMPO(I-1))
      TGXFS1=(TABVELO(I-1)+(DUR-TABTEMPO(I-1))*DELTA)
      RETURN
      END

C-----------------------------------------------------------
C---------FUNZIONI PER LA DESCRIZIONE DELLO SCATTO----------
C-----------------------------------------------------------
	REAL FUNCTION TGXFSC2(DUR)                                      !SNGL
C        DOUBLE PRECISION FUNCTION TGXFSC2(DUR)                          !DBLE
C      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   VELOCITA' DURANTE LO SCATTO
      PARAMETER (LDT=13)
      DIMENSION TABTEMPO(LDT),TABVELO(LDT)
      DATA TABTEMPO/0.,20.,40.,60.,80.,100.,120.,
     $                140.,160.,180.,220.,240.,460./
      DATA TABVELO/1.,.8,.63,.52,.43,.37,.33,.29,.
     $               24,.22,.20,.18,0./
      LDT1=LDT-1
      DO 10 I=2,LDT1
      IF(DUR-TABTEMPO(I)) 20,20,10
10    CONTINUE
      I=LDT
20    DELTA=(TABVELO(I)-TABVELO(I-1))/(TABTEMPO(I)-TABTEMPO(I-1))
      TGXFSC2=(TABVELO(I-1)+(DUR-TABTEMPO(I-1))*DELTA)
      RETURN
      END
C~FORAUS_TURG~C
C
C FORTRAN AUSILIARIO DEL MODULO POMPA CENTRIFUGA
C PER LA SUA SCRITTURA VEDERE MANUALE D'USO O
C UTILIZZARE L'APPOSITO COMANDO DI LEGOCAD.
C
CC     REAL FUNCTION TGXUTXFU10(QTGP,FTAMB)                               !SNGL
CC     DOUBLE PRECISION FUNCTION TGXUTXFU10(QTGP,FTAMB)                   !DBLE
CC      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
C--   CALCOLO DELLA TEMPERATURA DI RIFERIMENTO
C*********** BREVE SPIEGAZIONE DEI PARAMETRI DELLA SUBROUTINE ******************
C
C
C      SUBROUTINE UTENTE: DEVE FORNIRE IL VALORE DI SET PER IL CONTROLLO
C                         DELLA TEMPERATURA DI USCITA GAS DAL TURBO_GAS
C                         IN GRADI KELVIN
C
C      IN FUNZIONE DI  QTGP = POTENZA IN % ,
C                      FTAMB = TEMPERATURA AMBIENTE IN GRADI FARENHEIT
C
C
C____ ESEMPIO PER TURBOGAS TIPO   NUOVO PIGNONE
C
C     PARAMETER (LDT=13,LTC=5,LUR=65)
C     DIMENSION TABQ(LDT),TABTAM(LTC),TABTRX(LUR)
C     DATA TABQ/0.,20.,40.,62.,71.,77.6,80.,88.6,
C     &            97.,100.,110.6,121.7,130./
C     DATA TABTAM/0.,30.,59.,90.,120./
C     DATA TABTRX/1295.,1238.25,1181.5,1119.08,1093.54,
C     &              1074.82,1068.01,1043.61,
C     &              1019.77,1011.26,981.18,949.69,926.14,
C     &              1277.,1221.44,1165.89,1104.78,1079.78,
C     &              1061.44,1054.78,1030.89,1007.56,
C     &              999.22,969.78,938.94,915.89,
C     &             1240.,1190.,1140.,1085.,1062.5,1046.,
C     &              1040.,1018.5,997.5,989.33,963.5,
C     &            935.75,915.,1225.,1175.68,1126.36,1072.11,
C     &      1049.92,1033.65,1027.73,1006.52,
C     &      985.81,978.41,952.27,924.9,904.43,
C     &      1195.5,1151.45,1107.41,1058.95,1039.13,
C     &      1024.6,1019.31,1000.37,981.87,
C     &              975.26,951.92,927.47,909.19/
C
C     XQTG=100.
C     CALL TGLINTAB(TABTAM,LTC,TABQ,LDT,TABTRX,XQTG,FTAMB,TR,Z1,Z2)
C     TGXUTXFU10=(TR-32.)/1.8+273.15
C     RETURN
C     END
C
C
C      SUBROUTINE UTENTE: DEVE FORNIRE IL VALORE DI SET PER IL CONTROLLO
C                         DELLA TEMPERATURA DI USCITA GAS DAL TURBO_GAS
C                         IN GRADI KELVIN
C
C      IN FUNZIONE DI  POYX = POTENZA IN % ,
C                      FTAMB = TEMPERATURA AMBIENTE IN GRADI CENTIGRADI
C
C
C____ ESEMPIO PER TURBOGAS TIPO   F I A T
C
CC     REAL FUNCTION TGXUTXFF14(POYX,FTAMB)                               !SNGL
CC     DOUBLE PRECISION FUNCTION TGXUTXFF14(POYX,FTAMB)                   !DBLE
CC      IMPLICIT DOUBLE PRECISION (A-H, O-Z)                              !DBLE
CC--  CALCOLO TEMPERATURA DI RIFERIMENTO
C     PARAMETER (LDT=14,LTC=7,LUR=98)
C     DIMENSION TABQ(LDT),TABTAM(LTC),TABTRX(LUR)
C     DATA TABQ/42.,46.,49.9,54.1,57.8,61.7,65.7,
C     &       77.7,85.,92.3,100.,106.9,114.2,121.5/
C     DATA TABTAM/0.,20.,40.,59.,80.,100.,120./
C     DATA TABTRX/534.,531.,528.,525.,523.,520.,517.,
C     &      508.,503.,497.,492.,487.,481.,476.,
C     &      536.,533.,530.,527.,524.,521.,518.,
C     &      508.,503.,497.,491.,486.,480.,474.,
C     &      541.,538.,534.,531.,528.,524.,521.,
C     &      511.,505.,499.,492.,486.,480.,474.,
C     &      550.,546.,542.,538.,535.,531.,527.,
C     &      516.,509.,502.,495.,488.,482.,475.,
C     &      555.,551.,547.,543.,539.,535.,531.,
C     &      519.,511.,504.,496.,489.,482.,474.,
C     &      560.,556.,551.,547.,542.,538.,534.,
C     &      520.,512.,504.,495.,487.,479.,471.,
C     &      572.,567.,562.,557.,552.,547.,542.,
C     &      527.,518.,508.,499.,490.,481.,472./
C     XQTG=POYX
C     CALL TGLINTAB(TABTAM,LTC,TABQ,LDT,TABTRX,XQTG,FTAMB,TR,Z1,Z2)
C     TGXUTXFF14=TR+273.15
C     RETURN
C     END
C
C
C       FINE ESEMPIO .
C
C~FORAUS_TURG~C
CC
      SUBROUTINE TURGD1(BLOCCO,NEQUAZ,NSTATI,NUSCIT,NINGRE,SYMVAR,
     $  XYU,IXYU,DATI,IPD,SIGNEQ,UNITEQ,COSNOR,ITOPVA,MXT)
      RETURN
      END
